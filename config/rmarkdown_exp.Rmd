---
output: 
  html_document:
    highlight: haddock
    theme: flatly
    toc: true
    toc_float: true
    
---
<h1 style="text-align: center">`r paste0(b.name.sig," signature reporting file")`</h1>
<h4 style="text-align: center">Generated by <a href="https://omics.bjcancer.org/prognosis/" target = "_blank" style = "color:#008176">ReProMSig</a> version 1.0</h4>

<h4 style="text-align: center">`r tripod_create_date`</h4>

<style type="text/css">
	#header {
	    text-align: center;
	}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

<br/>

<br/>

`r tripod_generator`

`r tripod_email`

`r tripod_organization`


***

### <span style="color:#048D55">I. Signature summary</span>

`r signature_summary_texts`

```{r, echo=FALSE}
tripod_signature_description = paste0("<p><b>Signature description: </b><span style = 'color:#34621d'>",signature_description,"</span></p>")
htmltools::HTML(
	tripod_signature_description
)
```

<br/>

```{r, echo=FALSE}
used_validation_dataset_exists <- ifelse(length(used_validation_dataset) > 0, TRUE, FALSE)
used_validation_dataset0 <- paste0(used_validation_dataset,":")

rep_color_time <- ceiling(length(used_validation_dataset)/7)
format_dt_color1 <- rep(c('#d34b00','#dd8e0a','#e6c710','#9aa440','#347e86','#304e98','#816ab3'),rep_color_time)
valid_color <- format_dt_color1[1:length(used_validation_dataset)]
if(length(used_validation_dataset) > 0){
  valid_style <- data.frame(name=used_validation_dataset,name0=used_validation_dataset0,color=valid_color)
  valid_style$combined <- paste0("<span style='color:",valid_style$color,"'><b>",valid_style$name,"</b></span>")
  valid_style$combined0 <- paste0("<span style='color:",valid_style$color,"'><b>",valid_style$name0,"</b></span>")
} else {
  valid_style <- data.frame()
}

time_plot_width <- length(b.times) * 0.35
time_plot_width <- ifelse(time_plot_width > 1, '100%', paste0(time_plot_width*100,"%"))
```


```{r, echo=FALSE}
train_valid_dataset_summary <- ifelse(used_validation_dataset_exists, "<p style=\"margin-top:-10px\"><b>Training & Validation datasets</b></p>", "<p style=\"margin-top:-10px\"><b>Training dataset</b></p>")
htmltools::HTML(
	train_valid_dataset_summary
)
```

<hr style="background-color:#3C8DBC;height:1px;border:none;margin-top:0%"> </hr>


```{r dataset_summary2, echo = FALSE}
rownames(tripod_datasets_summary_df) <- NULL
tripod_datasets_summary_df <- tripod_datasets_summary_df[,c("Class",colnames(tripod_datasets_summary_df)[!colnames(tripod_datasets_summary_df) %in% "Class"])]
tripod_datasets_summary_df %>% 
  kableExtra::kable(escape=F) %>% 
  kableExtra::kable_styling(full_width = T) %>%
  kableExtra::row_spec(1,background="#ddd")
```

<hr style="background-color:#ddd;height:1px;margin-top:-15px"> </hr>

<br/>


### <span style="color:#048D55">II. Items of methods</span>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px;margin-top:25px">Item 4. Source of data</span>

##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px;margin-top:0px">Item 4a. Study design</span>

<p style="margin-top:0px"><b>Training dataset</b></p>

* <b>Study design or source of data</b>

```{r, echo=FALSE}
item4a_training_source <- gsub("\n","<br />",item4a_training_source)
item4a_training_source <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item4a_training_source,"</p>")
htmltools::HTML(
	item4a_training_source
)
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
htmltools::HTML('   
	<p><b>Validation dataset(s)</b></p><ul><li><b>Study design or source of data</b></li></ul>
')
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
item4a_validation_source <- gsub("\n"," <br /> ",item4a_validation_source)
item4a_validation_source <- style_datasetname(dataset_name=used_validation_dataset,dataset_name0=used_validation_dataset0,dataset_style=valid_style,text=item4a_validation_source)
item4a_validation_source <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item4a_validation_source,"</p>")
htmltools::HTML(
	item4a_validation_source
)
```

##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px">Item 4b. Key study dates</span>

<p style="margin-top:0px"><b>Training dataset</b></p>

```{r, echo=FALSE}
item4a_training_study_date <- gsub("\n","<br />",item4a_training_study_date)
item4a_training_study_date <- paste0("<p style=\"text-align: justify\">",item4a_training_study_date,"</p>")
htmltools::HTML(
	item4a_training_study_date
)
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
htmltools::HTML('   
	<p><b>Validation dataset(s)</b></p>
')
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
item4a_validation_study_date <- gsub("\n"," <br /> ",item4a_validation_study_date)
item4a_validation_study_date <- style_datasetname(dataset_name=used_validation_dataset,dataset_name0=used_validation_dataset0,dataset_style=valid_style,text=item4a_validation_study_date)
item4a_validation_study_date <- paste0("<p style=\"text-align: justify\">",item4a_validation_study_date,"</p>")
htmltools::HTML(
	item4a_validation_study_date
)
```

<br/>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px">Item 5. Participants</span>


##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px;margin-top:0px">Item 5a. Key study setting</span>

<p style="margin-top:0px"><b>Training dataset</b></p>

* <b>Study setting, number and location of centers</b>

```{r, echo=FALSE}
item5a_training_setting <- gsub("\n","<br />",item5a_training_setting)
item5a_training_setting <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item5a_training_setting,"</p>")
htmltools::HTML(
	item5a_training_setting
)
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
htmltools::HTML('   
	<p><b>Validation dataset(s)</b></p><ul><li><b>Study setting, number and location of centers</b></li></ul>
')
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
item5a_validation_setting <- gsub("\n"," <br /> ",item5a_validation_setting)
item5a_validation_setting <- style_datasetname(dataset_name=used_validation_dataset,dataset_name0=used_validation_dataset0,dataset_style=valid_style,text=item5a_validation_setting)
item5a_validation_setting <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item5a_validation_setting,"</p>")
htmltools::HTML(
	item5a_validation_setting
)
```


##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px">Item 5b. Eligibility criteria for participants</span>

<p style="margin-top:0px"><b>Training dataset</b></p>

* <b>Exclusion criteria</b>

<p style="margin-left:65px"><b>Clinical anlaysis</b></p>

```{r, echo=FALSE}
item5b_training_exclusion_user <- gsub("\n","<br />",item5b_training_exclusion_user)
item5b_training_exclusion_user <- paste0("<p style=\"text-align: justify;margin-left:65px\">",item5b_training_exclusion_user,"</p>")
htmltools::HTML(
	item5b_training_exclusion_user
)
```

<p style="margin-left:65px"><b>Statistical anlaysis</b></p>

```{r, echo=FALSE}
item5b_training_exclusion_web <- gsub("ReProMSig","ReProMSig",item5b_training_exclusion_web)
item5b_training_exclusion_web <- paste0("<p style=\"text-align: justify;margin-left:65px\">",item5b_training_exclusion_web,"</p>")
htmltools::HTML(   
item5b_training_exclusion_web
)
```

* <b>Inclusion criteria</b>

<p style="margin-left:65px"><b>Clinical anlaysis</b></p>

```{r, echo=FALSE}
item5b_training_inclusion_user <- gsub("\n","<br />",item5b_training_inclusion_user)
item5b_training_inclusion_user <- paste0("<p style=\"text-align: justify;margin-left:65px\">",item5b_training_inclusion_user,"</p>")
htmltools::HTML(
	item5b_training_inclusion_user
)
```

<p style="margin-left:65px"><b>Statistical anlaysis</b></p>

```{r, echo=FALSE}
item5b_training_inclusion_web <- gsub("ReProMSig","ReProMSig",item5b_training_inclusion_web)
item5b_training_inclusion_web <- paste0("<p style=\"text-align: justify;margin-left:65px\">",item5b_training_inclusion_web,"</p>")
htmltools::HTML(   
item5b_training_inclusion_web
)
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
htmltools::HTML('   
	<p><b>Validation dataset(s)</b></p><ul><li><b>Exclusion criteria</b></li></ul><p style="margin-left:65px"><b>Clinical anlaysis</b></p>
')
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
item5b_validation_exclusion_user <- gsub("\n"," <br /> ",item5b_validation_exclusion_user)
item5b_validation_exclusion_user <- style_datasetname(dataset_name=used_validation_dataset,dataset_name0=used_validation_dataset0,dataset_style=valid_style,text=item5b_validation_exclusion_user)
item5b_validation_exclusion_user <- paste0("<p style=\"text-align: justify;margin-left:65px\">",item5b_validation_exclusion_user,"</p>")
htmltools::HTML(
	item5b_validation_exclusion_user
)
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
htmltools::HTML('   
	<p style="margin-left:65px"><b>Statistical anlaysis</b></p>
')
```


```{r, eval= used_validation_dataset_exists, echo=FALSE}
item5b_validation_exclusion_web <- gsub("ReProMSig","ReProMSig",item5b_validation_exclusion_web)
item5b_validation_exclusion_web <- gsub("\n"," <br /> ",item5b_validation_exclusion_web)
item5b_validation_exclusion_web <- style_datasetname(dataset_name=used_validation_dataset,dataset_name0=used_validation_dataset0,dataset_style=valid_style,text=item5b_validation_exclusion_web)
item5b_validation_exclusion_web <- paste0("<p style=\"text-align: justify;margin-left:65px\">",item5b_validation_exclusion_web,"</p>")
htmltools::HTML(   
	item5b_validation_exclusion_web
)
```


```{r, eval= used_validation_dataset_exists, echo=FALSE}
htmltools::HTML('   
	<ul><li><b>Inclusion criteria</b></li></ul><p style="margin-left:65px"><b>Clinical anlaysis</b></p>
')
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
item5b_validation_inclusion_user <- gsub("\n"," <br /> ",item5b_validation_inclusion_user)
item5b_validation_inclusion_user <- style_datasetname(dataset_name=used_validation_dataset,dataset_name0=used_validation_dataset0,dataset_style=valid_style,text=item5b_validation_inclusion_user)
item5b_validation_inclusion_user <- paste0("<p style=\"text-align: justify;margin-left:65px\">",item5b_validation_inclusion_user,"</p>")
htmltools::HTML(   
	item5b_validation_inclusion_user
)
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
htmltools::HTML('   
	<p style="margin-left:65px"><b>Statistical anlaysis</b></p>
')
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
item5b_validation_inclusion_web <- gsub("ReProMSig","ReProMSig",item5b_validation_inclusion_web)
item5b_validation_inclusion_web <- gsub("\n"," <br /> ",item5b_validation_inclusion_web)
item5b_validation_inclusion_web <- style_datasetname(dataset_name=used_validation_dataset,dataset_name0=used_validation_dataset0,dataset_style=valid_style,text=item5b_validation_inclusion_web)
item5b_validation_inclusion_web <- paste0("<p style=\"text-align: justify;margin-left:65px\">",item5b_validation_inclusion_web,"</p>")
htmltools::HTML(   
	item5b_validation_inclusion_web
)
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
item5b_validation_similar0 <- paste0("<ul><li><b>Is it similar to the eligibility criteria used in training dataset</b></li></ul><p style=\"text-align: justify;margin-left:25px\">",item5b_validation_similar,"</p>")
htmltools::HTML(   
	item5b_validation_similar0
)
```


##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px">Item 5c. Received treatments</span>

<p style="margin-top:0px"><b>Training dataset</b></p>

* <b>Treatment details</b>

<p style="text-align: justify;margin-left:25px">`r item5c_training`</p>

```{r, eval= used_validation_dataset_exists, echo=FALSE}
item5c_validation <- gsub("\n"," <br /> ",item5c_validation)
item5c_validation <- style_datasetname(dataset_name=used_validation_dataset,dataset_name0=used_validation_dataset0,dataset_style=valid_style,text=item5c_validation)
item5c_validation0 <- paste0("<p><b>Validation dataset(s)</b></p><ul><li><b>Treatment details</b></li></ul><p style=\"text-align: justify;margin-left:25px\">",item5c_validation,"</p>")
htmltools::HTML(   
	item5c_validation0
)
```

<br/>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px">Item 6. Outcome</span>


##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px;margin-top:0px">Item 6a. Clinical endpoints being analyzed</span>

* <p style="margin-top:0px"><b>Outcome</b></p>

```{r, echo=FALSE}
item6a_training_outcome <- gsub("\n","<br /> ",item6a_training_outcome)
item6a_training_outcome <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item6a_training_outcome,"</p>")
htmltools::HTML(   
	item6a_training_outcome
)
```

* <b>How and when assessed</b>

```{r, echo=FALSE}
item6a_training_methods <- gsub("\n","<br /> ",item6a_training_methods)
item6a_training_methods <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item6a_training_methods,"</p>")
htmltools::HTML(   
	item6a_training_methods
)
```


##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px">Item 6b. Actions for blind assessment of the outcome</span>

```{r, echo=FALSE}
item6b_training <- gsub("\n","<br /> ",item6b_training)
item6b_training <- paste0("<p style=\"text-align: justify;margin-top:0px\">",item6b_training,"</p>")
htmltools::HTML(   
	item6b_training
)
```

<br/>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px">Item 7. Predictors</span>


##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px;margin-top:0px">Item 7a. Predictors used in developing the multivariable prediction model</span>

```{r, echo=FALSE}
item7a_training <- gsub("\n","<br /> ",item7a_training)
item7a_training <- paste0("<p style=\"text-align: justify;margin-top:0px\">",item7a_training,"</p>")
htmltools::HTML(   
	item7a_training
)
```

##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px">Item 7b. Actions for blind assessment of predictors</span>

```{r, echo=FALSE}
item7b_training <- gsub("\n","<br /> ",item7b_training)
item7b_training <- paste0("<p style=\"text-align: justify;margin-top:0px\">",item7b_training,"</p>")
htmltools::HTML(   
	item7b_training
)
```

<br/>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px">Item 8. Sample Size</span>

* <p style="margin-top:0px"><b>How the study size arrived at</b></p>

```{r, echo=FALSE}
item8_training <- gsub("\n","<br /> ",item8_training)
item8_training <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item8_training,"</p>")
htmltools::HTML(   
	item8_training
)
```

<br/>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px">Item 9. Missing Data</span>

<p style="margin-top:0px"><b>Training dataset</b></p>

* <b>Missing value handling</b>

```{r, echo=FALSE}
if(!exists("item9_training_methods_user")){item9_training_methods_user=""}
item9_training_methods_user_exists <- ifelse(item9_training_methods_user == "", FALSE, TRUE)

if(!exists("item9_validation_methods_user")){item9_validation_methods_user=""}
item9_validation_methods_user_exists <- ifelse(item9_validation_methods_user == "", FALSE, TRUE)
```

```{r, echo=FALSE}
item9_training_methods <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item9_training_methods,"</p>")
htmltools::HTML(   
	item9_training_methods
)
```

```{r, eval= item9_training_methods_user_exists, echo=FALSE}
item9_training_methods_user <- gsub("\n","<br /> ",item9_training_methods_user)
item9_training_methods_user <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item9_training_methods_user,"</p>")
htmltools::HTML(   
	item9_training_methods_user
)
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
item9_validation_methods0 <- paste0("<p><b>Validation dataset(s)</b></p><ul><li><b>Missing value handling</b></li></ul><p style=\"text-align: justify;margin-left:25px\">",item9_validation_methods,"</p>")
htmltools::HTML(   
	item9_validation_methods0
)
```

```{r, eval= item9_validation_methods_user_exists, echo=FALSE}
item9_validation_methods_user <- gsub("\n","<br /> ",item9_validation_methods_user)
item9_validation_methods_user <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item9_validation_methods_user,"</p>")
htmltools::HTML(   
	item9_validation_methods_user
)
```


<br/>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px">Item 10. Statistical Analysis Methods</span>


##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px;margin-top:0px">Item 10a. Predictors handling method</span>

* <p style="margin-top:0px"><b>Molecular profiles</b></p>

<p style="text-align: justify;margin-left:25px">`r item10a_handling_molecular`</p>

* <b>Implausible observations</b>

<p style="text-align: justify;margin-left:25px">`r item10a_implausible`</p>
 
##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px">Item 10b. Model building procedures</span>

* <p style="margin-top:0px"><b>Predictor selection before modeling</b></p>

```{r, echo=FALSE}
item10b_before_genes <- gsub("\n","<br /> ",item10b_before_genes)
item10b_before_genes <- gsub("ReProMSig","ReProMSig",item10b_before_genes)
item10b_before_genes <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item10b_before_genes,"</p>")
htmltools::HTML(   
	item10b_before_genes
)
```

```{r, echo=FALSE}
item10b_before <- gsub("\n","<br /> ",item10b_before)
item10b_before <- gsub("ReProMSig","ReProMSig",item10b_before)
item10b_before <- paste0("<p style=\"text-align: justify;margin-left:25px\">",item10b_before,"</p>")
htmltools::HTML(   
	item10b_before
)
```

* <b>Multivariable prediction model building</b>

<p style="text-align: justify;margin-left:25px">`r item10b_model`</p>

* <b>Collinearity assessment</b>

<p style="margin-left:25px">The correlations between each pair of selected molecular predictors were estimated using Pearson correlation analysis, to evaluate the presence of collinearity. However, we did not exclude any predictors even if  potential collinearity found.</p>

```{r, echo=FALSE}
htmltools::HTML('  
	<h4><span style="background-color:#B1BB4E;color:white;display:block;padding:5px">Item 10c. Prediction method for the validation dataset(s)</span></h4>
')
```

```{r, echo=FALSE}
if(used_validation_dataset_exists){
	item10c <- paste0("<ul><li><p style=\"margin-top:0px\"><b>Signature model</b></p></li></ul><p style=\"text-align: justify;margin-left:25px\">",item10c_signature,"</p><ul><li><b>Nomogram</b></li></ul><p style=\"text-align: justify;margin-left:25px\">",item10c_nomogram,"</p><ul><li><b>Online research tool</b></li></ul><p style=\"text-align: justify;margin-left:25px\">",item10c_online,"</p>")
} else {
	item10c <- "No validation dataset used in this study."
}
htmltools::HTML(   
	item10c
)
```

##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px">Item 10d. Model performance assessment</span>

```{r, echo=FALSE}
if(b.signature.type == "Predictive"){
	item10d_independence_exists = FALSE
	item10d_independence = ""
} else {
	item10d_independence_exists = TRUE
}
```

```{r, eval= item10d_independence_exists, echo=FALSE}
htmltools::HTML('   
	<ul><li><p style="margin-top:0px"><b>Independence test</b></p></li></ul>
')
```

<p style="text-align: justify;margin-left:25px">`r item10d_independence`</p>

* <b>Interaction test</b>

<p style="text-align: justify;margin-left:25px">`r item10d_interaction`</p>

* <b>Kaplan-Meier analysis</b>

<p style="text-align: justify;margin-left:25px">`r item10d_km`</p>

* <b>Time dependent receiver operating characteristic (ROC) analysis</b>

<p style="text-align: justify;margin-left:25px">`r item10d_roc`</p>

* <b>Prediction error (PE) curve analysis</b>

<p style="text-align: justify;margin-left:25px">`r item10d_pe`</p>

* <b>Calibration plots</b>

<p style="text-align: justify;margin-left:25px">`r item10d_calibration`</p>

* <b>`r b.endpoint`</b>

<p style="text-align: justify;margin-left:25px">`r item10d_km_pro`</p>

```{r, eval= CP_association_exists, echo=FALSE}
htmltools::HTML(  
	paste0("<ul><li><p style=\"margin-top:0px\"><b>Association analysis</b></p></li></ul><p style=\"text-align: justify;margin-left:25px\">",item10d_association,"</p>")
)
```

##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px">Item 10e. Model updating arising from the validation</span>

```{r, echo=FALSE}
item10e_updating <- gsub("\n","<br /> ",item10e_updating)
item10e_updating <- paste0("<p style=\"text-align: justify;margin-top:0px\">",item10e_updating,"</p>")
htmltools::HTML(   
	item10e_updating
)
```

<br/>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px">Item 11. Risk Groups</span>

<p style="text-align: justify;margin-top:0px">`r item11_groups`</p>

<br/>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px">Item 12. Development vs. Validation</span>

```{r, echo=FALSE}
if(used_validation_dataset_exists) {
	item12_setting <- gsub("\n","<br /> ",item12_setting)
	item12_eligibility <- gsub("\n","<br /> ",item12_eligibility)
	item12_outcome <- gsub("\n","<br /> ",item12_outcome)
	item12_predictors <- gsub("\n","<br /> ",item12_predictors)
	item12_validation <- paste0("<p style=\"margin-top:0px\"><b>Differences in development and validation</b></p><li><b>Setting</b></li><p style=\"text-align: justify;margin-left:25px\">",item12_setting,"</p><li><b>Eligibility criteria</b></li><p style=\"text-align: justify;margin-left:25px\">",item12_eligibility,"</p><li><b>Outcome</b></li><p style=\"text-align: justify;margin-left:25px\">",item12_outcome,"</p><li><b>Predictors</b></li><p style=\"text-align: justify;margin-left:25px\">",item12_predictors,"</p><br/>")
} else {
	item12_validation <- "No validation dataset used in this study."
}
htmltools::HTML(   
	item12_validation
)
```
				 
<br/>

### <span style="color:#048D55">III. Items of results</span>


#### <span style="background-color:#048D55;color:white;display:block;padding:5px;margin-top:25px">Item 13. Participants</span>


##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px;margin-top:0px">Item 13a. Study participants</span>

```{r, eval = figure_flow_diagram_exists, echo=FALSE}
htmltools::HTML(' 
	<p style="margin-top:0px"><b>Study flow diagram</b> (optional): showing the flow of participants through the study</p>

')
```

```{r flow_diagram, eval = figure_flow_diagram_exists, echo=FALSE, out.width = '100%'}
knitr::include_graphics(user_upload_diagram_path, dpi=600)
```

```{r, eval = figure_flow_diagram_exists, echo=FALSE}
htmltools::HTML(' 
	<br/>
')
```

<p><b>Training dataset</b></p>

```{r, echo=FALSE}
item13a_training_text_html <- paste0("<p style=\"text-align: justify\">",item13a_training_text_html,"</p>")
item13a_training_text_html <- gsub("Training dataset:","In the training dataset,",item13a_training_text_html)
htmltools::HTML( 
	item13a_training_text_html
)
```

```{r, eval= used_validation_dataset_exists, echo=FALSE}
item13a_validations_text_html <- gsub("\n","<br /> ",item13a_validations_text_html)
item13a_validations_text_html <- style_datasetname(dataset_name=used_validation_dataset,dataset_name0=used_validation_dataset0,dataset_style=valid_style,text=item13a_validations_text_html)
item13a_validations_text_html0 <- paste0("<p><b>Validation dataset(s)</b></p><p style=\"text-align: justify\">",item13a_validations_text_html,"</p>")
htmltools::HTML( 
	item13a_validations_text_html0
)
```

```{r, echo=FALSE}
if(used_validation_dataset_exists) {
	item13b_c <- "<h5><span style=\"background-color:#B1BB4E;color:white;display:block;padding:5px;margin-bottom:0px\">Item 13b/c. Comparison of participant characteristics between the training and validation datasets</span></h5>"
} else {
	item13b_c <- "<h5><span style=\"background-color:#B1BB4E;color:white;display:block;padding:5px;margin-bottom:0px\">Item 13b/c. Characteristics of participants</span></h5>"
}
htmltools::HTML(
	item13b_c
)
```

<p style="margin-top:0px;color:#3C8DBC"><b>Clinical and pathological characteristics</b></p>
<hr style="background-color:#3C8DBC;height:1px;border:none;margin-top:0%"> </hr>

```{r}
patient_characteristic_summary_data
```

<p style="text-align: justify">`r item13b_c_patient_characteristic_legend`</p>

<br/>


```{r, echo=FALSE}
item13b_c_profile_title0 <- paste0("<p><span style=\"color:#3C8DBC\"><b>",item13b_c_profile_title,"</b></span></p><hr style=\"background-color:#3C8DBC;height:1px;border:none;margin-top:0%\"> </hr>")
htmltools::HTML(
	item13b_c_profile_title0
)

```


```{r figure_exp_distr_train_validsets, echo=FALSE, out.width = '100%'}
knitr::include_graphics(figure_exp_distr_train_validsets, dpi=600)
```


<p style="text-align: justify">`r item13b_c_profile_distribution_text`</p>

<br/>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px;margin-bottom:0px">Item 14. Model Development</span>

<p style="margin-top:0px;color:#3C8DBC"><b>Unadjusted association between each candidate predictor and outcome in the training dataset</b></p>
<hr style="background-color:#3C8DBC;height:1px;border:none;margin-top:0%"> </hr>

```{r}
table_uni_cox
```

<p style="text-align: justify">`r item14_unicox_legend`</p>

<br/>

<p style="text-align: justify"><b>TRIPOD relevance:</b> This table reports the information needed suggested by Item 14a \"Number of participants and outcome events involved in model development\" and Item 14b \"Unadjusted association between each candidate predictor and outcome\".</p>

<br/>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px">Item 15. Model Speciﬁcation</span>

##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px;margin-bottom:0px;margin-top:0px">Item 15a. Details of the prediction model</span>


```{r, echo=FALSE}
item15a_signature_table_title0 <- paste0("<p style=\"margin-top:0px;color:#3C8DBC\"><b>",item15a_signature_table_title,"</b></p><hr style=\"background-color:#3C8DBC;height:1px;border:none;margin-top:0%\"> </hr>")
htmltools::HTML(
	item15a_signature_table_title0
)
```


```{r}
coef_report_new
```

```{r, echo=FALSE}
item15a_signature_text <- gsub("\\*","&#42",item15a_signature_text)
item15a_signature_text0 <- paste0("<p style=\"margin-top:-15px\">",item15a_signature_text,"</p>")
htmltools::HTML(   
item15a_signature_text0
)
```

<br/>

```{r, eval = figure_sig_corrplot_exist, echo=FALSE}
item15a_profile_correlation_title0 <- paste0("<p style=\"color:#3C8DBC\"><b>",item15a_profile_correlation_title,"</b></p><hr style=\"background-color:#3C8DBC;height:1px;border:none;margin-top:0%\"> </hr>")
htmltools::HTML(
	item15a_profile_correlation_title0
)
```

```{r figure_sig_corrplot, eval = figure_sig_corrplot_exist, echo=FALSE, out.width = '35%'}
knitr::include_graphics(figure_sig_corrplot, dpi=600)
```

<p style="text-align: justify">`r item15a_profile_correlation_text`</p>

<br/>

##### <span style="background-color:#B1BB4E;color:white;display:block;padding:5px;margin-bottom:0px">Item 15b. Application of the prediction model</span>

```{r, eval = figure_nomogram_exist, echo=FALSE}
item15b_nomogram_title0 <- paste0("<p style=\"margin-top:0px;color:#3C8DBC\"><b>",item15b_nomogram_title,"</b></p><hr style=\"background-color:#3C8DBC;height:1px;border:none;margin-top:0%\"> </hr>")
htmltools::HTML(
	item15b_nomogram_title0
)
```


```{r figure_nomogram, eval = figure_nomogram_exist,echo=FALSE,out.width = '80%'}
if(b.signature.type == "Prognostic"){
	knitr::include_graphics(figure_nomogram, dpi=600)
	
} else {
	figure_nomogram_all_pts_exist <- TRUE
	knitr::include_graphics(figure_nomogram_all_pts, dpi=600)
	
}
```

<p style="text-align: justify">`r item15b_nomogram_text`</p>

<br/>

#### <span style="background-color:#048D55;color:white;display:block;padding:5px;margin-bottom:0px">Item 16. Model Performance</span>

<p style="margin-top:0px;color:#3C8DBC"><b>Cox regression analysis of signature and clinicopathological variables (training dataset)</b></p>
<hr style="background-color:#3C8DBC;height:1px;border:none;margin-top:0%"> </hr>

```{r, echo=FALSE}
table_uni_multi_cox
```

<p style="text-align: justify">`r item14_cox_legend`</p>

<br/>

<p style="color:#3C8DBC"><b>Receiver operating characteristic (ROC) analysis (training dataset)</b></p>
<hr style="background-color:#3C8DBC;height:1px;border:none;margin-top:0%"> </hr>

```{r figure_roc, echo=FALSE, out.width = time_plot_width}
knitr::include_graphics(figure_roc, dpi=600)
```

<p style="text-align: justify">`r item16_ROC_text`</p>


<br/>


<p style="color:#3C8DBC"><b>Calibration of the molecular signature (training dataset)</b></p>
<hr style="background-color:#3C8DBC;height:1px;border:none;margin-top:0%"> </hr>

```{r figure_calibrate_lines_signature, eval = figure_calibrate_lines_signature_exist, echo=FALSE, out.width = time_plot_width}
knitr::include_graphics(figure_calibrate_lines_signature, dpi=600)
```

<p style="text-align: justify">`r item16_calibration_molecular_legend`</p>

<br/>


```{r, eval = figure_nomogram_exist, echo=FALSE}
item16_calibration_title0 <- paste0("<p style=\"color:#3C8DBC\"><b>",item16_calibration_title,"</b></p><hr style=\"background-color:#3C8DBC;height:1px;border:none;margin-top:0%\"> </hr>")
htmltools::HTML(
	item16_calibration_title0
)
```


```{r figure_calibrate_lines, eval = figure_nomogram_exist, echo=FALSE, out.width = time_plot_width}
if(b.signature.type == "Prognostic"){
	knitr::include_graphics(figure_calibrate_lines, dpi=600)
} else {
	figure_calibrate_all_pts_exist <- TRUE
	knitr::include_graphics(figure_calibrate_lines_all_pts, dpi=600)
}
```


```{r, eval = figure_nomogram_exist, echo=FALSE}
item16_calibration_text <- paste0("<p style=\"text-align: justify\">",item16_calibration_text,"</p><br/>")
htmltools::HTML(
	item16_calibration_text
)
```


<p style="color:#3C8DBC"><b>Prediction error (PE) curve analysis (training dataset)</b></p>
<hr style="background-color:#3C8DBC;height:1px;border:none;margin-top:0%"> </hr>

```{r figure_pe, echo=FALSE, out.width = '35%'}
knitr::include_graphics(figure_pe, dpi=600)
```

<p style="text-align: justify">`r item16_PE_text`

<br/>


```{r, eval = CP_association_exists, echo=FALSE}
item16_cp_text <- paste0("<p style=\"color:#3C8DBC\"><b>Association analysis of signature-predicted risk groups with clinicopathological variables</b></p><hr style=\"background-color:#3C8DBC;height:1px;border:none;margin-top:0%\"></hr>")
htmltools::HTML(
	item16_cp_text
)
```


```{r, eval = CP_association_exists, echo = FALSE}
CP_Stat_report_new
```

```{r, eval = CP_association_exists, echo=FALSE}
item16_cp_legend <- paste0("<p style=\"text-align: justify\">",item16_association_text,"</p><br/>")
htmltools::HTML(
	item16_cp_legend
)
```

<p style="margin-top:0px;color:#3C8DBC"><b>Kaplan-Meier analysis of signature-predicted risk groups</b></p>
<hr style="background-color:#3C8DBC;height:1px;border:none;margin-top:0%"> </hr>


```{r, echo=FALSE}
kmpath = paste0(b.user.sig.path,"/tripod/")
all_valid <- c("Validation_dataset_1","Validation_dataset_2","Validation_dataset_3")
valid <- names(valid_KM_prex.list)
diff_valid <- setdiff(all_valid,valid)
validation_dataset1_exists <- ifelse("Validation_dataset_1" %in% diff_valid, FALSE, TRUE)
validation_dataset2_exists <- ifelse("Validation_dataset_2" %in% diff_valid, FALSE, TRUE)
validation_dataset3_exists <- ifelse("Validation_dataset_3" %in% diff_valid, FALSE, TRUE)
km.outwidth <- ifelse(b.signature.type == "Prognostic", '50%', '100%')
```


##### {.tabset}

###### Training dataset

```{r figure_km_trainset, echo=FALSE, out.width = km.outwidth}
figure_km_trainset <- list.files(path = kmpath, 
                      pattern = paste0("^figure_km_Training_dataset.*.png$"),
                      full.names = TRUE)
knitr::include_graphics(figure_km_trainset, dpi=600)
cat("\n")
```

```{r, results = 'asis', eval = validation_dataset1_exists, echo=FALSE, out.width = km.outwidth}
cat("######  Validation dataset 1", "\n")
figure_km_validation1 <- list.files(path = kmpath, 
                      pattern = paste0("^figure_km_Validation_dataset_1.*.png$"),
                      full.names = TRUE)
knitr::include_graphics(figure_km_validation1, dpi=600)
cat("\n")
```


```{r, results = 'asis', eval = validation_dataset2_exists, echo=FALSE, out.width = km.outwidth}
cat("######  Validation dataset 2", "\n")
figure_km_validation2 <- list.files(path = kmpath, 
                      pattern = paste0("^figure_km_Validation_dataset_2.*.png$"),
                      full.names = TRUE)
knitr::include_graphics(figure_km_validation2, dpi=600)
cat("\n")
```


```{r, results = 'asis', eval = validation_dataset3_exists, echo=FALSE, out.width = km.outwidth}
cat("######  Validation dataset 3", "\n")
figure_km_validation3 <- list.files(path = kmpath, 
                      pattern = paste0("^figure_km_Validation_dataset_3.*.png$"),
                      full.names = TRUE)
knitr::include_graphics(figure_km_validation3, dpi=600)
cat("\n")
```


##### {-}



<p style="text-align: justify">`r item16_KM_text`</p>


<br/>


<p style="color:#3C8DBC"><b>`r item16_surv_title`</b></p>

<hr style="background-color:#3C8DBC;height:1px;border:none;margin-top:0%"> </hr>

```{r}
surv_prob_report_new
```

<p style="text-align: justify">`r item16_surv_text`</p>

<br/>



